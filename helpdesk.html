<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HelpDisk - Customer Support System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3f37c9;
      --accent: #4cc9f0;
      --dark: #2b2d42;
      --light: #f8f9fa;
      --danger: #ef233c;
      --success: #4ad66d;
      --warning: #ff9e00;
      --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f5f7ff;
      color: var(--dark);
      min-height: 100vh;
    }

    .container {
      display: grid;
      grid-template-columns: 250px 1fr;
      min-height: 100vh;
    }

    /* Sidebar Styles */
    .sidebar {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 20px 0;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      position: relative;
      z-index: 10;
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 30px;
    }

    .logo i {
      font-size: 1.8rem;
      color: var(--accent);
    }

    .logo h1 {
      font-size: 1.3rem;
      font-weight: 600;
    }

    .nav-menu {
      display: flex;
      flex-direction: column;
      gap: 5px;
      padding: 0 15px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 15px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      color: white;
    }

    .nav-item:hover, .nav-item.active {
      background-color: rgba(255, 255, 255, 0.1);
    }

    .nav-item i {
      font-size: 1.1rem;
      width: 24px;
      text-align: center;
    }

    /* Main Content Styles */
    .main-content {
      padding: 30px;
      overflow-y: auto;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .header h2 {
      font-size: 1.8rem;
      color: var(--dark);
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
    }

    /* Module Cards */
    .modules {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .module-card {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: var(--card-shadow);
      transition: all 0.3s ease;
      cursor: pointer;
      border-left: 4px solid var(--primary);
    }

    .module-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .module-card i {
      font-size: 2.2rem;
      color: var(--primary);
      margin-bottom: 15px;
    }

    .module-card h3 {
      font-size: 1.3rem;
      margin-bottom: 10px;
      color: var(--dark);
    }

    .module-card p {
      color: #666;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    /* Module Content Areas */
    .module-content {
      display: none;
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: var(--card-shadow);
      animation: fadeIn 0.5s ease;
    }

    .module-content.active {
      display: block;
    }

    /* Complaint Form Styles */
    .complaint-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group.full-width {
      grid-column: span 2;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--dark);
    }

    input, select, textarea {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-family: 'Poppins', sans-serif;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    input:focus, select:focus, textarea:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }

    textarea {
      min-height: 120px;
      resize: vertical;
    }

    .form-actions {
      grid-column: span 2;
      display: flex;
      justify-content: flex-end;
      gap: 15px;
      margin-top: 20px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
    }

    .btn-success {
      background-color: var(--success);
      color: white;
    }

    .btn-danger {
      background-color: var(--danger);
      color: white;
    }

    .btn-warning {
      background-color: var(--warning);
      color: white;
    }

    .btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    /* Tickets Table */
    .tickets-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .tickets-table th, .tickets-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    .tickets-table th {
      background-color: #f5f7ff;
      font-weight: 600;
      color: var(--dark);
    }

    .tickets-table tr:hover {
      background-color: #f9faff;
    }

    .status-badge {
      padding: 5px 10px;
      border-radius: 50px;
      font-size: 0.8rem;
      font-weight: 500;
      display: inline-block;
    }

    .status-new {
      background-color: rgba(67, 97, 238, 0.2);
      color: var(--primary);
    }

    .status-in-progress {
      background-color: rgba(255, 158, 0, 0.2);
      color: var(--warning);
    }

    .status-resolved {
      background-color: rgba(74, 214, 109, 0.2);
      color: var(--success);
    }

    .status-escalated {
      background-color: rgba(239, 35, 60, 0.2);
      color: var(--danger);
    }

    .priority-high {
      color: var(--danger);
      font-weight: 600;
    }

    .priority-medium {
      color: var(--warning);
      font-weight: 600;
    }

    .priority-low {
      color: var(--success);
      font-weight: 600;
    }

    /* Ticket Cards for Mobile */
    .tickets-grid {
      display: none;
      grid-template-columns: 1fr;
      gap: 15px;
    }

    .ticket-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: var(--card-shadow);
      transition: all 0.3s ease;
      border-left: 4px solid var(--primary);
    }

    .ticket-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    }

    .ticket-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .ticket-title {
      font-weight: 600;
      margin-bottom: 5px;
    }

    .ticket-meta {
      display: flex;
      justify-content: space-between;
      color: #888;
      font-size: 0.85rem;
      margin-bottom: 10px;
    }

    .ticket-desc {
      color: #666;
      margin-bottom: 15px;
      font-size: 0.95rem;
      line-height: 1.5;
    }

    .ticket-actions {
      display: flex;
      gap: 10px;
    }

    /* Escalation Form */
    .escalation-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Responsive Design */
    @media (max-width: 992px) {
      .container {
        grid-template-columns: 1fr;
      }

      .sidebar {
        display: none;
      }

      .complaint-form {
        grid-template-columns: 1fr;
      }

      .form-group.full-width {
        grid-column: span 1;
      }

      .form-actions {
        grid-column: span 1;
      }
    }

    @media (max-width: 768px) {
      .modules {
        grid-template-columns: 1fr;
      }

      .tickets-table {
        display: none;
      }

      .tickets-grid {
        display: grid;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar Navigation -->
    <div class="sidebar">
      <div class="logo">
        <i class="fas fa-headset"></i>
        <h1>HelpDisk</h1>
      </div>
      <div class="nav-menu">
        <a href="#" class="nav-item active" data-module="dashboard">
          <i class="fas fa-tachometer-alt"></i>
          <span>Dashboard</span>
        </a>
        <a href="#" class="nav-item" data-module="complaints">
          <i class="fas fa-exclamation-circle"></i>
          <span>User Complaints</span>
        </a>
        <a href="#" class="nav-item" data-module="tracking">
          <i class="fas fa-tasks"></i>
          <span>Track Issues</span>
        </a>
        <a href="#" class="nav-item" data-module="escalation">
          <i class="fas fa-arrow-up"></i>
          <span>Escalate Cases</span>
        </a>
        <a href="#" class="nav-item" data-module="reports">
          <i class="fas fa-chart-bar"></i>
          <span>Reports</span>
        </a>
      </div>
    </div>

    <!-- Main Content Area -->
    <div class="main-content">
      <!-- Dashboard Header -->
      <div class="header">
        <h2>Customer Support Dashboard</h2>
        <div class="user-profile">
          <div class="user-avatar">SU</div>
          <span>Support User</span>
        </div>
      </div>

      <!-- Dashboard Modules -->
      <div class="modules" id="dashboard-module">
        <div class="module-card" data-module="complaints">
          <i class="fas fa-exclamation-circle"></i>
          <h3>User Complaints</h3>
          <p>Receive and manage customer complaints and support requests from users.</p>
        </div>
        <div class="module-card" data-module="tracking">
          <i class="fas fa-tasks"></i>
          <h3>Track Issues</h3>
          <p>Monitor and respond to ongoing issues, update statuses, and communicate with users.</p>
        </div>
        <div class="module-card" data-module="escalation">
          <i class="fas fa-arrow-up"></i>
          <h3>Escalate Cases</h3>
          <p>Elevate serious cases to higher support tiers or management when needed.</p>
        </div>
      </div>

      <!-- User Complaints Module -->
      <div class="module-content" id="complaints-module">
        <h3><i class="fas fa-exclamation-circle"></i> Submit New Complaint</h3>
        <form id="complaint-form" class="complaint-form">
          <div class="form-group">
            <label for="complaint-name">Your Name</label>
            <input type="text" id="complaint-name" required>
          </div>
          <div class="form-group">
            <label for="complaint-email">Email Address</label>
            <input type="email" id="complaint-email" required>
          </div>
          <div class="form-group">
            <label for="complaint-category">Issue Category</label>
            <select id="complaint-category" required>
              <option value="">Select Category</option>
              <option value="technical">Technical Issue</option>
              <option value="billing">Billing Problem</option>
              <option value="account">Account Access</option>
              <option value="feature">Feature Request</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label for="complaint-priority">Priority</label>
            <select id="complaint-priority" required>
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
              <option value="critical">Critical</option>
            </select>
          </div>
          <div class="form-group full-width">
            <label for="complaint-subject">Subject</label>
            <input type="text" id="complaint-subject" required>
          </div>
          <div class="form-group full-width">
            <label for="complaint-details">Details</label>
            <textarea id="complaint-details" required></textarea>
          </div>
          <div class="form-group full-width">
            <label for="complaint-attachments">Attachments (if any)</label>
            <input type="file" id="complaint-attachments" multiple>
          </div>
          <div class="form-actions">
            <button type="reset" class="btn btn-danger">
              <i class="fas fa-times"></i> Cancel
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-paper-plane"></i> Submit Complaint
            </button>
          </div>
        </form>
      </div>

      <!-- Issue Tracking Module -->
      <div class="module-content" id="tracking-module">
        <div class="tracking-actions">
          <button class="btn btn-primary" id="refresh-tickets-btn">
            <i class="fas fa-sync-alt"></i> Refresh
          </button>
          <div class="filter-group" style="display: inline-block; margin-left: 15px;">
            <label for="ticket-filter" style="margin-right: 10px;">Filter:</label>
            <select id="ticket-filter" class="btn">
              <option value="all">All Tickets</option>
              <option value="new">New</option>
              <option value="in-progress">In Progress</option>
              <option value="resolved">Resolved</option>
              <option value="escalated">Escalated</option>
            </select>
          </div>
        </div>
        
        <!-- Desktop Table View -->
        <table class="tickets-table">
          <thead>
            <tr>
              <th>Ticket ID</th>
              <th>Subject</th>
              <th>Submitted By</th>
              <th>Category</th>
              <th>Priority</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="tickets-table-body">
            <!-- Tickets will be loaded here -->
          </tbody>
        </table>
        
        <!-- Mobile Card View -->
        <div class="tickets-grid" id="tickets-grid">
          <!-- Tickets will be loaded here -->
        </div>
      </div>

      <!-- Case Escalation Module -->
      <div class="module-content" id="escalation-module">
        <h3><i class="fas fa-arrow-up"></i> Escalate Serious Case</h3>
        <form id="escalation-form" class="escalation-form">
          <div class="form-group">
            <label for="escalate-ticket">Select Ticket to Escalate</label>
            <select id="escalate-ticket" required>
              <option value="">Select a ticket...</option>
              <!-- Tickets will be populated here -->
            </select>
          </div>
          <div class="form-group">
            <label for="escalate-reason">Reason for Escalation</label>
            <select id="escalate-reason" required>
              <option value="">Select reason...</option>
              <option value="technical-complexity">Technical Complexity</option>
              <option value="management-approval">Requires Management Approval</option>
              <option value="legal-concerns">Legal/Compliance Concerns</option>
              <option value="customer-demand">High-Profile Customer Demand</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label for="escalate-level">Escalation Level</label>
            <select id="escalate-level" required>
              <option value="tier2">Tier 2 Support</option>
              <option value="management">Management</option>
              <option value="executive">Executive Team</option>
            </select>
          </div>
          <div class="form-group">
            <label for="escalate-details">Additional Details</label>
            <textarea id="escalate-details" rows="4" required></textarea>
          </div>
          <div class="form-actions">
            <button type="reset" class="btn btn-danger">
              <i class="fas fa-times"></i> Cancel
            </button>
            <button type="submit" class="btn btn-warning">
              <i class="fas fa-arrow-up"></i> Escalate Case
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Ticket Detail Modal -->
  <div class="modal" id="ticket-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-ticket-alt"></i> Ticket Details</h2>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-body" id="ticket-details">
        <!-- Ticket details will be loaded here -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-cancel close-modal">Close</button>
        <button type="button" class="btn btn-primary" id="respond-ticket-btn">
          <i class="fas fa-reply"></i> Respond
        </button>
      </div>
    </div>
  </div>

  <!-- Response Modal -->
  <div class="modal" id="response-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-reply"></i> Respond to Ticket</h2>
        <button class="close-modal">&times;</button>
      </div>
      <form id="response-form">
        <input type="hidden" id="response-ticket-id">
        <div class="modal-body">
          <div class="form-group">
            <label for="response-status">Update Status</label>
            <select id="response-status">
              <option value="in-progress">In Progress</option>
              <option value="resolved">Resolved</option>
              <option value="escalated">Escalated</option>
            </select>
          </div>
          <div class="form-group">
            <label for="response-message">Your Response</label>
            <textarea id="response-message" rows="5" required></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-cancel close-modal">Cancel</button>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-paper-plane"></i> Send Response
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    $(document).ready(function() {
      // Sample data
      let tickets = [
        { 
          id: 1001, 
          subject: "Cannot login to my account", 
          name: "John Doe", 
          email: "john@example.com",
          category: "account", 
          priority: "high", 
          status: "new",
          date: "2023-05-15 09:30",
          details: "I've been trying to login to my account since yesterday but keep getting an error message saying my credentials are invalid, even though I'm sure they're correct.",
          responses: []
        },
        { 
          id: 1002, 
          subject: "Billing discrepancy", 
          name: "Jane Smith", 
          email: "jane@example.com",
          category: "billing", 
          priority: "medium", 
          status: "in-progress",
          date: "2023-05-14 14:15",
          details: "I was charged twice for my subscription this month. Please refund the duplicate charge.",
          responses: [
            {
              date: "2023-05-14 15:30",
              agent: "Support Team",
              message: "We've received your complaint and are looking into the billing issue. Please allow 24-48 hours for our team to investigate.",
              status: "in-progress"
            }
          ]
        },
        { 
          id: 1003, 
          subject: "Feature request: Dark mode", 
          name: "Mike Johnson", 
          email: "mike@example.com",
          category: "feature", 
          priority: "low", 
          status: "new",
          date: "2023-05-15 11:45",
          details: "Please add a dark mode option to the application. The bright white interface is straining my eyes during night time use.",
          responses: []
        }
      ];

      // Initialize GSAP animations
      gsap.from(".module-card", {
        duration: 0.6,
        y: 20,
        opacity: 0,
        stagger: 0.1,
        ease: "power2.out"
      });

      // Module switching
      $("[data-module]").on("click", function(e) {
        e.preventDefault();
        const module = $(this).data("module");
        
        // Update active nav item
        $(".nav-item").removeClass("active");
        $(this).addClass("active");
        
        // Hide all modules
        $(".module-content").removeClass("active");
        $(".modules").hide();
        
        // Show selected module
        if (module === "dashboard") {
          $(".modules").show();
          gsap.from(".module-card", {
            duration: 0.4,
            y: 20,
            opacity: 0,
            stagger: 0.1,
            ease: "power2.out"
          });
        } else {
          $(`#${module}-module`).addClass("active");
          loadModuleData(module);
        }
      });

      // Load data for specific module
      function loadModuleData(module) {
        switch(module) {
          case "complaints":
            // Nothing special needed for complaints form
            break;
          case "tracking":
            renderTicketsTable();
            break;
          case "escalation":
            populateEscalationTickets();
            break;
        }
      }

      // Complaint form submission
      $("#complaint-form").on("submit", function(e) {
        e.preventDefault();
        
        // Get form values
        const name = $("#complaint-name").val();
        const email = $("#complaint-email").val();
        const category = $("#complaint-category").val();
        const priority = $("#complaint-priority").val();
        const subject = $("#complaint-subject").val();
        const details = $("#complaint-details").val();
        
        // Validate
        if (!name || !email || !category || !subject || !details) {
          Swal.fire("Error", "Please fill all required fields", "error");
          return;
        }
        
        // Create new ticket
        const newId = tickets.length > 0 ? Math.max(...tickets.map(t => t.id)) + 1 : 1001;
        const newTicket = {
          id: newId,
          subject,
          name,
          email,
          category,
          priority,
          status: "new",
          date: new Date().toLocaleString(),
          details,
          responses: []
        };
        
        tickets.push(newTicket);
        
        // Show success
        Swal.fire({
          title: "Complaint Submitted!",
          html: `Your ticket <strong>#${newId}</strong> has been received. We'll respond within 24 hours.`,
          icon: "success",
          confirmButtonColor: "#4361ee"
        });
        
        // Reset form
        this.reset();
      });

      // Render tickets table
      function renderTicketsTable(filter = "all") {
        const $tbody = $("#tickets-table-body");
        const $grid = $("#tickets-grid");
        $tbody.empty();
        $grid.empty();
        
        let filteredTickets = tickets;
        if (filter !== "all") {
          filteredTickets = tickets.filter(t => t.status === filter);
        }
        
        // Desktop table view
        filteredTickets.forEach(ticket => {
          const statusClass = `status-${ticket.status.replace(" ", "-")}`;
          const priorityClass = `priority-${ticket.priority}`;
          
          $tbody.append(`
            <tr data-id="${ticket.id}">
              <td>#${ticket.id}</td>
              <td>${ticket.subject}</td>
              <td>${ticket.name}</td>
              <td>${ticket.category.charAt(0).toUpperCase() + ticket.category.slice(1)}</td>
              <td class="${priorityClass}">${ticket.priority.charAt(0).toUpperCase() + ticket.priority.slice(1)}</td>
              <td><span class="status-badge ${statusClass}">${ticket.status.charAt(0).toUpperCase() + ticket.status.slice(1)}</span></td>
              <td>
                <button class="btn btn-primary btn-view-ticket" data-id="${ticket.id}">
                  <i class="fas fa-eye"></i> View
                </button>
                <button class="btn btn-success btn-respond-ticket" data-id="${ticket.id}">
                  <i class="fas fa-reply"></i> Respond
                </button>
              </td>
            </tr>
          `);
        });
        
        // Mobile grid view
        filteredTickets.forEach(ticket => {
          const statusClass = `status-${ticket.status.replace(" ", "-")}`;
          const priorityClass = `priority-${ticket.priority}`;
          
          $grid.append(`
            <div class="ticket-card" data-id="${ticket.id}">
              <div class="ticket-header">
                <h4 class="ticket-title">${ticket.subject}</h4>
                <span class="status-badge ${statusClass}">${ticket.status.charAt(0).toUpperCase() + ticket.status.slice(1)}</span>
              </div>
              <div class="ticket-meta">
                <span>#${ticket.id}</span>
                <span class="${priorityClass}">${ticket.priority.charAt(0).toUpperCase() + ticket.priority.slice(1)} Priority</span>
              </div>
              <p class="ticket-desc">${ticket.details.substring(0, 100)}${ticket.details.length > 100 ? '...' : ''}</p>
              <div class="ticket-actions">
                <button class="btn btn-primary btn-view-ticket" data-id="${ticket.id}">
                  <i class="fas fa-eye"></i> View
                </button>
                <button class="btn btn-success btn-respond-ticket" data-id="${ticket.id}">
                  <i class="fas fa-reply"></i> Respond
                </button>
              </div>
            </div>
          `);
        });
        
        // Add event listeners
        $(".btn-view-ticket").on("click", function() {
          const ticketId = $(this).data("id");
          viewTicketDetails(ticketId);
        });
        
        $(".btn-respond-ticket").on("click", function() {
          const ticketId = $(this).data("id");
          prepareResponse(ticketId);
        });
      }

      // View ticket details
      function viewTicketDetails(id) {
        const ticket = tickets.find(t => t.id === id);
        if (!ticket) return;
        
        const statusClass = `status-${ticket.status.replace(" ", "-")}`;
        const priorityClass = `priority-${ticket.priority}`;
        
        let responsesHtml = '';
        if (ticket.responses.length > 0) {
          responsesHtml = '<h4 style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px;">Responses</h4>';
          ticket.responses.forEach(response => {
            responsesHtml += `
              <div style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #f5f5f5;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                  <strong>${response.agent}</strong>
                  <small>${response.date}</small>
                </div>
                <p>${response.message}</p>
                ${response.status ? `<small>Status changed to: <span class="status-badge status-${response.status.replace(" ", "-")}">${response.status.charAt(0).toUpperCase() + response.status.slice(1)}</span></small>` : ''}
              </div>
            `;
          });
        } else {
          responsesHtml = '<p style="margin-top: 20px; font-style: italic;">No responses yet.</p>';
        }
        
        $("#ticket-details").html(`
          <div style="margin-bottom: 15px;">
            <h3>${ticket.subject}</h3>
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
              <span>Ticket #${ticket.id}</span>
              <span class="status-badge ${statusClass}">${ticket.status.charAt(0).toUpperCase() + ticket.status.slice(1)}</span>
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
            <div>
              <strong>Submitted By:</strong>
              <p>${ticket.name} (${ticket.email})</p>
            </div>
            <div>
              <strong>Date Submitted:</strong>
              <p>${ticket.date}</p>
            </div>
            <div>
              <strong>Category:</strong>
              <p>${ticket.category.charAt(0).toUpperCase() + ticket.category.slice(1)}</p>
            </div>
            <div>
              <strong>Priority:</strong>
              <p class="${priorityClass}">${ticket.priority.charAt(0).toUpperCase() + ticket.priority.slice(1)}</p>
            </div>
          </div>
          
          <div style="margin-bottom: 15px;">
            <strong>Details:</strong>
            <p style="white-space: pre-line; margin-top: 5px;">${ticket.details}</p>
          </div>
          
          ${responsesHtml}
        `);
        
        $("#response-ticket-id").val(ticket.id);
        $("#ticket-modal").fadeIn();
      }

      // Prepare response form
      function prepareResponse(id) {
        const ticket = tickets.find(t => t.id === id);
        if (!ticket) return;
        
        $("#response-ticket-id").val(ticket.id);
        $("#response-status").val(ticket.status);
        $("#response-message").val("");
        
        $("#ticket-modal").fadeOut();
        $("#response-modal").fadeIn();
      }

      // Submit response
      $("#response-form").on("submit", function(e) {
        e.preventDefault();
        
        const ticketId = $("#response-ticket-id").val();
        const status = $("#response-status").val();
        const message = $("#response-message").val();
        
        if (!message) {
          Swal.fire("Error", "Please enter a response message", "error");
          return;
        }
        
        const ticketIndex = tickets.findIndex(t => t.id == ticketId);
        if (ticketIndex === -1) return;
        
        // Add response
        tickets[ticketIndex].responses.push({
          date: new Date().toLocaleString(),
          agent: "Support User",
          message,
          status: status !== tickets[ticketIndex].status ? status : null
        });
        
        // Update status if changed
        if (status !== tickets[ticketIndex].status) {
          tickets[ticketIndex].status = status;
        }
        
        // Show success
        Swal.fire("Success!", "Your response has been submitted.", "success");
        
        // Close modal and refresh
        $("#response-modal").fadeOut();
        renderTicketsTable($("#ticket-filter").val());
      });

      // Populate escalation tickets dropdown
      function populateEscalationTickets() {
        const $select = $("#escalate-ticket");
        $select.empty().append('<option value="">Select a ticket...</option>');
        
        // Only show tickets that aren't already escalated
        const eligibleTickets = tickets.filter(t => t.status !== "escalated");
        
        eligibleTickets.forEach(ticket => {
          $select.append(`<option value="${ticket.id}">#${ticket.id} - ${ticket.subject} (${ticket.status})</option>`);
        });
      }

      // Handle escalation form submission
      $("#escalation-form").on("submit", function(e) {
        e.preventDefault();
        
        const ticketId = $("#escalate-ticket").val();
        const reason = $("#escalate-reason").val();
        const level = $("#escalate-level").val();
        const details = $("#escalate-details").val();
        
        if (!ticketId || !reason || !level || !details) {
          Swal.fire("Error", "Please fill all required fields", "error");
          return;
        }
        
        const ticketIndex = tickets.findIndex(t => t.id == ticketId);
        if (ticketIndex === -1) return;
        
        // Update ticket status
        tickets[ticketIndex].status = "escalated";
        
        // Add escalation note
        tickets[ticketIndex].responses.push({
          date: new Date().toLocaleString(),
          agent: "Support User",
          message: `Case escalated to ${level} for reason: ${reason}. Details: ${details}`,
          status: "escalated"
        });
        
        // Show success
        Swal.fire({
          title: "Case Escalated!",
          html: `Ticket <strong>#${ticketId}</strong> has been escalated to <strong>${level}</strong>.`,
          icon: "success",
          confirmButtonColor: "#4361ee"
        });
        
        // Reset form and refresh
        this.reset();
        populateEscalationTickets();
        renderTicketsTable($("#ticket-filter").val());
      });

      // Ticket filter
      $("#ticket-filter").on("change", function() {
        renderTicketsTable($(this).val());
      });

      // Refresh tickets
      $("#refresh-tickets-btn").on("click", function() {
        renderTicketsTable($("#ticket-filter").val());
        Swal.fire("Refreshed!", "Ticket list has been updated.", "success");
      });

      // Modal close handlers
      $(".close-modal").on("click", function() {
        $(this).closest(".modal").fadeOut();
      });

      $(window).on("click", function(e) {
        if ($(e.target).hasClass("modal")) {
          $(".modal").fadeOut();
        }
      });

      // Respond from ticket modal
      $("#respond-ticket-btn").on("click", function() {
        const ticketId = $("#response-ticket-id").val();
        $("#ticket-modal").fadeOut();
        prepareResponse(ticketId);
      });
    });
  </script>
</body>
</html>